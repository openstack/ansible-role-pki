---
# Copyright 2021, BBC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# CA certificates to create
pki_authorities: []

# Global enable/disable of CA generation
pki_create_ca: true

# Variable name pattern to search ansible vars for other authority definitions
pki_search_authorities_pattern: "pki_authorities_"

# Example variables defining a certificate authorities
# pki_authorities_roots:
#   - name: "SnakeRoot"
#     email_address: "pki@snakeoil.com"
#     cn: "Snake Oil Corp Root CA"
#     country_name: "GB"
#     state_or_province_name: "England"
#     organization_name: "Snake Oil Corporation"
#     organizational_unit_name: "IT Security"
#     key_usage:
#       - digitalSignature
#       - cRLSign
#       - keyCertSign
#     ttl: "3650d"
#     # standalone backend only
#     provider: selfsigned
#     basic_constraints: "CA:TRUE"
#     # hashi_vault backend only

#pki_authorities_intermediates:
#   - name: "SnakeRootIntermediate"
#     email_address: "pki@snakeoil.com"
#     cn: "Snake Oil Corp Openstack Infrastructure Intermediate CA"
#     country_name: "GB"
#     state_or_province_name: "England"
#     organization_name: "Snake Oil Corporation"
#     organizational_unit_name: "IT Security"
#     key_usage:
#       - digitalSignature
#       - cRLSign
#       - keyCertSign
#     ttl: "365d"
#     signed_by: "SnakeRoot"
#     # standalone backend only
#     provider: ownca
#     # hashi_vault backend only
#     vault_path: pki_int

# example variable of CA to install
# pki_install_ca:
#   # CA created but the PKI role
#   - name: SnakeRoot
#
#   # user provided CA copied from the deploy host (src), to the target (filename)
#   - src: /opt/my-ca/MyRoot.crt
#     filename: /etc/ssl/certs/MyRoot.crt
#
pki_install_ca: []

# Variable name pattern to search ansible vars for other certificate definitions
pki_search_install_ca_pattern: "pki_install_ca_"

# set this to the name of a CA to regenerate, or to 'true' to regenerate all
pki_regen_ca: ""

# Server certificates to create
pki_certificates: []

# Variable name pattern to search ansible vars for other certificate definitions
pki_search_certificates_pattern: "pki_certificates_"

# Example variable defining a server certificate
# pki_certificates_default:
#   - name: "SnakeWeb"
#     cn: "www.snakeoil.com"
#     san:
#       dns:
#         - www.snakeoil.com
#         - snakeoil.com
#     # standalone backend only
#     provider: ownca
#   - name: "SnakeMail"
#     cn: "imap.snakeoil.com"
#     signed_by: "SnakeRootIntermediate"
#     # standalone backend only
#     provider: ownca
#     ttl: 30d

# Example variable defining a server certificate from ansible host variables
# pki_certificates_default:
#   - name: "myservice_{{ ansible_facts['hostname'] }}"
#     cn: "{{ ansible_facts['hostname'] }}"
#     san:
#       dns:
#         - "{{ ansible_facts['hostname'] }}"
#         - "{{ ansible_facts['fqdn'] }}"
#       ip:
#         - "{{ ansible_facts['default_ipv4'] }}"
#     signed_by: "SnakeRootIntermediate"
#     # standalone backend only
#     provider: ownca

# set this to the name of the certificate to regenerate, or to 'true' to regenerate all
pki_regen_cert: ""

# host where the generated PKI files are kept
pki_setup_host: localhost

# Python interpreter that will be used during cert generation
pki_setup_host_python_interpreter: "{{ (pki_setup_host == 'localhost') | ternary(ansible_playbook_python, ansible_facts['python']['executable']) }}"

# certificates to install
pki_install_certificates: []

# Variable name pattern to search ansible vars for other certificate definitions
pki_search_install_certificates_pattern: "pki_install_certificates_"

# Example variable for installation of server certificates with optional user supplied cert override
# pki_install_certificates:
#     # server certificate
#   - name: "{{ ansible_facts['hostname'] }}"
#     type: "certificate_chain"
#     dest: "{{ myservice_ssl_cert }}"
#     owner: "root"
#     group: "root"
#     mode: "0644"
#     #private key
#   - name: "{{ ansible_facts['hostname'] }}"
#     type: "private_key"
#     dest: "{{ myservice_ssl_key }}"
#     owner: "myservice"
#     group: "myservice"
#     mode: "0600"
#     # intermediate CA
#   - name: "{{ ansible_facts['hostname'] }}"
#     type: "ca_bundle"
#     dest: "{{ myservice_ssl_ca_cert }}"
#     owner: "myservice"
#     group: "myservice"
#     mode: "0644"

# Handlers naming
pki_handler_ca_changed: "ca cert changed"
pki_handler_cert_changed: "cert changed"
pki_handler_cert_installed: "cert installed"

# permissions used when files are installed on the target
pki_cert_mode: "0644"
pki_cert_dir_mode: "0755"
pki_key_mode: "0600"
pki_key_dir_mode: "0700"
pki_file_mode:
  certificate: "{{ pki_cert_mode }}"
  certificate_chain: "{{ pki_cert_mode }}"
  ca_bundle: "{{ pki_cert_mode }}"
  private_key: "{{ pki_key_mode }}"

# file ownership when files are installed on the target
#  applies to all files installed
#  or, applies to all files not having a more specific owner:group in pki_install_certificates
pki_install_owner: "root"
pki_install_group: "root"

# default backend used to create the certificates
# NOTE(damiandabrowski): Remove backwards compatbility with pki_method after 2026.1
pki_backend: "{{ pki_method | default(openstack_pki_backend | default('standalone')) }}"

# standalone backend variables
# base directory for the CA and server certificates
pki_dir: "/etc/pki"
# Default permissions used on pki_setup_host
# pki_owner: "root"
# pki_group: "root"

# hashi_vault backend variables
pki_hashi_vault_role: "{{ openstack_pki_hashi_vault_role | default('default') }}"
pki_hashi_vault_engine_mount_point: "{{ openstack_pki_hashi_vault_engine_mount_point | default('pki_int') }}"
pki_hashi_vault_auth_method: userpass
pki_hashi_vault_login:
pki_hashi_vault_password:
pki_hashi_vault_token:
pki_hashi_vault_role_id:
pki_hashi_vault_secret_id:
pki_hashi_vault_jwt:
